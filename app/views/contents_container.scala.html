@(user: models.dto.UserDto, contentType: String, topic: String)

<!DOCTYPE html>
<html lang="en">
<!-- begin::Head -->
<head>
<meta charset="utf-8" />
<title>MOLIERE | Dashboard</title>
<meta name="description" content="Updates and statistics">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!--begin::Fonts -->
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
	WebFont.load({
		google : {
			"families" : [ "Poppins:300,400,500,600,700",
					"Roboto:300,400,500,600,700"]
		},
		active : function() {
			sessionStorage.fonts = true;
		}
	});
</script>

<style type="text/css">
.mord .text{
	width: 100px;
	word-break:break-all;  
}

</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

<!--end::Fonts -->
<!--begin::Page Vendors Styles(used by this page) -->
<link
	href="assets/vendors/custom/fullcalendar/fullcalendar.bundle.css"
	rel="stylesheet" type="text/css" />
<!--end::Page Vendors Styles -->
<!--begin::Global Theme Styles(used by all pages) -->
<link href="assets/vendors/global/vendors.bundle.css" rel="stylesheet"
	type="text/css" />
<link href="assets/stylesheets/style.bundle.css" rel="stylesheet"
	type="text/css" />
<!--end::Global Theme Styles -->
<!--begin::Layout Skins(used by all pages) -->
<link href="assets/stylesheets/skins/header/base/light.css"
	rel="stylesheet" type="text/css" />
<link href="assets/stylesheets/skins/header/menu/light.css"
	rel="stylesheet" type="text/css" />
<link href="assets/stylesheets/skins/brand/dark.css" rel="stylesheet"
	type="text/css" />
<link href="assets/stylesheets/skins/aside/dark.css" rel="stylesheet"
	type="text/css" />
<!--end::Layout Skins -->
<link rel="shortcut icon" href="assets/images/logos/logo-mini-2-md.png" />

<link href="assets/stylesheets/pages/general/wizard/wizard-3.css" rel="stylesheet" type="text/css">
</head>
<!-- end::Head -->
<!-- begin::Body -->
<body class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header-mobile--fixed kt-subheader--fixed kt-subheader--enabled kt-subheader--solid kt-aside--enabled kt-aside--fixed kt-page--loading">
	<div class="kt-subheader   kt-grid__item" id="kt_subheader">
	    <div class="kt-container  kt-container--fluid ">
	        <div class="kt-subheader__main"> 
	            <h3 class="kt-subheader__title">
		            @contentType match {
						case "pdf" => {
							@topic match {	
								case "functions_sev_var" =>{
									Functions of two variables
								}
								case "critical_points" =>{
									Critical Points
								}
								case _ => {}
							}
						}
						case "assignment" => {
							@topic match{
								case "functions_sev_var" => {
									Functions of two variables assignment 
								}
								case "critical_points" => {
									Critical points assignment
								}
								case _ => {}
							}
						}
						case "ar" => {
							AR Learning
						}
						case "quiz" => {
							Quiz
						}	
						case _ => {}
					}
	            </h3>
	            <span class="kt-subheader__separator kt-hidden"></span>
	            <div class="kt-subheader__breadcrumbs">
	                <a href="/dashboard?username=@user.getEmail()" class="kt-subheader__breadcrumbs-home"><i class="flaticon2-shelter"></i></a>                   
	            </div>    
	            <span class="kt-subheader__separator kt-hidden"></span>
	            <div class="kt-subheader__breadcrumbs">
	            	<a href="/course?courseId=HarvardX/CB22x/2013_Spring"> Mathematical Analysis II -</a>
					@contentType match {
						case "pdf" => {
							@topic match {	
								case "functions_sev_var" =>{
									Functions of two variables
								}
								case "critical_points" =>{
									Critical Points
								}
								case _ => {}
							}
						}
						case "assignment" => {
							@topic match{
								case "functions_sev_var" => {
									Functions of two variables assignment 
								}
								case "critical_points" => {
									Critical points assignment
								}
								case _ => {}
							}
						}
						case "ar" => {
							AR Learning
						}
						case "quiz" => {
							Quiz
						}	
						case _ => {}
					}
	            </div>         
	        </div>
    	</div>
	</div>    
	@contentType match {
		case "ar" => {
			@views.html._layout(user, "ar")
		}
		case "pdf" => {
			@topic match {
				case "functions_sev_var" => {
					@views.html._layout(user, "functions_sev_var_pdf")
				}
				case "critical_points" =>{
					@views.html._layout(user, "critical_points_pdf")
				}
				case _ => {}
			}
		
		}
		case "assignment" => {
			@topic match {
				case "functions_sev_var" => {
					@views.html._layout(user, "functions_sev_var_assignment")
				}
				case "critical_points" =>{
					@views.html._layout(user, "critical_points_assignment")
				}
				case _ => {}
			}
		}
		case "quiz" => {
			@views.html._layout(user, "quiz")
		}
		case _ => {}
		
	}
	 
	 
	<!-- begin::Global Config(global config for global JS sciprts) -->
	
	<script>
		var KTAppOptions = {
			"colors" : {
				"state" : {
					"brand" : "#5d78ff",
					"dark" : "#282a3c",
					"light" : "#ffffff",
					"primary" : "#5867dd",
					"success" : "#34bfa3",
					"info" : "#36a3f7",
					"warning" : "#ffb822",
					"danger" : "#fd3995"
				},
				"base" : {
					"label" : [ "#c5cbe3", "#a1a8c3", "#3d4465", "#3e4466" ],
					"shape" : [ "#f0f3ff", "#d9dffa", "#afb4d4", "#646c9a" ]
				}
			}
		};
	</script>
	<!-- end::Global Config -->

	
	<!--begin::Global Theme Bundle(used by all pages) -->
	<script src="assets/vendors/global/vendors.bundle.js" type="text/javascript"></script>
	<script src="assets/javascripts/scripts.bundle.js" type="text/javascript"></script>
	<!--end::Global Theme Bundle -->
	<!--begin::Page Vendors(used by this page) -->
	<script src="assets/vendors/custom/fullcalendar/fullcalendar.bundle.js" type="text/javascript"></script>
	<script src="//maps.google.com/maps/api/js?key=AIzaSyBTGnKT7dt597vo9QgeQ7BFhvSRP4eiMSM" type="text/javascript"></script>
	<script src="assets/vendors/custom/gmaps/gmaps.js" type="text/javascript"></script>
	<!--end::Page Vendors -->
	<!--begin::Page Scripts(used by this page) -->
	<script src="assets/javascripts/pages/dashboard.js" type="text/javascript"></script>
	<!--end::Page Scripts -->
	<!--begin::Page Scripts(used by content) -->
	<script src="assets/javascripts/pages//layout/aside/menu/contentView.js" type="text/javascript"></script>
	<!--end::Page Scripts -->
	<script src="assets/vendors/custom/flot/flot.bundle.js" type="text/javascript"></script>
		
	<script src="assets/javascripts/pages/wizard/wizard-3.js" type="text/javascript"></script>
	@contentType match {
		case "quiz" | "assignment" => {
			<script src="assets/javascripts/pages/quiz-handler.js"></script>
		}
		case _ => {}
	}
	
	<script>
		$(document).ready(function(){
			var startTime = Math.floor(Date.now()/1000);
			//Function that return the time elapsed on a page
			function getElapsedTime(){
				var currentTime= Math.floor(Date.now()/1000);
				return currentTime - startTime;
			}
			
			@contentType match {
				case "pdf" => {
					$('a[href="/course?courseId=HarvardX/CB22x/2013_Spring"], a[href="/dashboard?username=@user.getEmail()"]').click(function(){
						$.ajax({
							url: "/updateLearningResult",
							data: "courseId=HarvardX/CB22x/2013_Spring&userId=@user.getUserId&contentType=@contentType&topic=@topic&elapsedTime="+getElapsedTime(),
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							success: function(data){
								window.location.replace("/course?courseId=HarvardX/CB22x/2013_Spring");
							},
							error: function(err){
								console.log(err)		
							}
						});				
					});	
				}
	
				case "quiz" | "assignment" => {
					
					//RETRIEVE QUESTIONS
					$.ajax({
							url: "/retrieveQuestions",
							data:"contentType=@contentType&topic=@topic",
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							success: function(data){
								console.log(data)
								var n_questions = data["questions"].length;
								var n_answers;
								if("@contentType" == "quiz"){
									n_answers= data["answers"].length;	
								}
								var n_question = 1;
								var current_question= 1;
								var questions_list= shuffle(data["questions"]);
								var answers_list = data["answers"];
								var answersFeedback

								//INIT QUESTIONS
								for(var i=0 ; i< n_questions; i++){
									initFormQuestions(questions_list[i], (i+1),"@contentType");
								}
								
								if("@contentType" == "assignment"){
									$(".feedback_container").remove();
								}
								appendFormActions("@contentType");
								
								//RETRIEVE ANSWERS
								if("@contentType" == "quiz"){
									for(var j=0; j<n_answers; j++ ){
										if(questions_list[current_question-1].questionId == answers_list[j].questionId){
											answersFeedback= answers_list[j];
											console.log(answersFeedback);
										}
									}
								}
								
									
								$('button[data-ktwizard-type="action-next"]').prop("disabled",true);
								if("@contentType"=="quiz")
									checkQuizScore(n_question, n_questions, questions_list[current_question-1].rightAnswer, answersFeedback);
								else 
									checkAssignmentScore(n_question, n_questions, questions_list[current_question-1].rightAnswer);
								$('button[data-ktwizard-type="action-prev"]').click(function(event){
									event.preventDefault();
									$("#question_"+current_question).removeAttr("data-ktwizard-state");
									$("#nav_"+current_question).removeAttr("data-ktwizard-state");
									current_question --;
									$("#question_"+current_question).attr("data-ktwizard-state", "current");
									$("#nav_"+current_question).attr("data-ktwizard-state", "current");
									if(isAnswered(current_question)){
										$('button[data-ktwizard-type="action-next"]').prop("disabled",false);
									}
								});
								
								$('button[data-ktwizard-type="action-next"]').click(function(event){
									event.preventDefault();
									
									$('button[data-ktwizard-type="action-prev"]').show();
									$("#nav_"+current_question).removeAttr("data-ktwizard-state");
									$("#question_"+current_question).removeAttr("data-ktwizard-state");
									
									current_question++;
									$("#question_"+current_question).attr("data-ktwizard-state", "current");
									$("#nav_"+current_question).attr("data-ktwizard-state", "current");
									
									
									//RETRIEVE ANSWERS
									for(var j=0; j<n_answers; j++ ){
										if(questions_list[current_question-1].questionId == answers_list[j].questionId){
											answersFeedback= answers_list[j];
											console.log(answersFeedback);
										}
									}
														
									if(!isAnswered(current_question)){
										$(this).prop("disabled", true);
									}else{
										$(this).prop("disabled", false);
									}
									
									n_question++;
									if("@contentType"=="quiz")
										checkQuizScore(n_question, n_questions, questions_list[current_question-1].rightAnswer, answersFeedback);
									else 
										checkAssignmentScore(n_question, n_questions, questions_list[current_question-1].rightAnswer);
									
									if(current_question == n_questions)
										$("#kt_wizard_v3").attr("data-ktwizard-state", "last");
																
								});
								
								$('#submit-btn').click(function(){
									var content="";
									var imgSrc="";
									if(getResult() == 0){
										content= "You should study all the lessons in this chapter again, trying to use simpler content. You will be supported by a teacher to improve your learning.";	
										imgSrc= "sink.svg";
									}
									else if(getResult() == 1 || getResult() == 2){
										content= "You should do better. Try to learn more using the additional content and ask for help on the forum to solve your doubts.";
										imgSrc="car-breakdown.svg";

									}
									else if(getResult() == 3 || getResult() == 4){
										content= "Well done, you can move to the next chapter. Nevertheless, It could be useful to discuss with your colleagues the obtained results in online chat.";
										imgSrc="hammock.svg";
									}
									else if(getResult() == 5){
										content="Very well, waiting for the next chapter you can relax.";	
										imgSrc="startup.svg";
									}
									
									$("#quiz-feedback-content").append(
											"<div>"+
											"	<img src='assets/images/files/"+imgSrc+"' alt='' style='height: 150px; width: 150px; margin:3% 5%; float: left;'>"+
											"	<h3 style='margin-top: 2%;'>You did "+getResult()+" of "+n_questions+" correct answers</h3><hr style='margin-left:27%;'>"+
											"</div>"+
											"<h5 class='text-justify'>"+content+"</h5>"
									);
										
									$.ajax({
										url: "/courseQuizResult",
										data: "courseId=HarvardX/CB22x/2013_Spring&userId=@user.getUserId&contentType=@contentType&topic=@topic&elapsedTime="+getElapsedTime()+"&achievedScore="+getResult()+"&totalScore="+n_questions,
										contentType: "application/json; charset=utf-8",
										dataType: "json",
										success: function(data){
											if("@contentType" == "assignment")
												window.location.replace("/course?courseId=HarvardX/CB22x/2013_Spring");
										},
										error: function(err){
											console.log(err)		
										}
									});
								});
								
								$("#quiz-feedback-btn").click(function(){
									window.location.replace("/course?courseId=HarvardX/CB22x/2013_Spring");
								});
								
							},
							error: function(err){
								console.log(err)		
							}
						});

				}
				
				case _ => {}
						
			}
		});
				
	</script>
</body>
<!-- end::Body -->
</html>